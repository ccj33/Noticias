<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Destaques do Quadro</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <style>
    body { 
      font-family: sans-serif; 
      margin: 20px; 
      background-color: #f4f5f7; 
    }
    .carrossel { 
      max-width: 500px; 
      margin: auto; 
      background: #fff; 
      border-radius: 12px; 
      padding: 24px; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
    }
    .slide { 
      display: none; 
      text-align: center; 
    }
    .slide.active { 
      display: block; 
    }
    .slide img { 
      width: 100%; 
      max-height: 220px; 
      object-fit: cover; 
      border-radius: 8px; 
      margin-bottom: 12px; 
      background-color: #eee; 
    }
    .controles { 
      text-align: center; 
      margin-top: 16px; 
    }
    button { 
      background: #0079bf; 
      color: #fff; 
      border: none; 
      padding: 8px 16px; 
      border-radius: 4px; 
      cursor: pointer; 
      margin: 0 5px; 
    }
    button:hover { 
      background: #005f8c; 
    }
    .status { 
      text-align: center; 
      color: #666; 
      margin-bottom: 20px; 
    }
  </style>
</head>
<body>
  <div class="carrossel" id="carrossel">
    <div class="status" id="status">Carregando cartões...</div>
  </div>
  <div class="controles">
    <button id="anterior">Anterior</button>
    <button id="proximo">Próximo</button>
  </div>
  
  <script>
    const status = document.getElementById('status');
    const carrossel = document.getElementById('carrossel');
    let slides = [];
    let atual = 0;

    function mostrarSlide(idx) {
      if (slides.length === 0) return;
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === idx);
      });
      atual = idx;
    }

    function criarSlide(cartao) {
      const slide = document.createElement('div');
      slide.className = 'slide';
      const imgUrl = (cartao.attachments && cartao.attachments.length > 0)
        ? cartao.attachments[0].url
        : 'https://via.placeholder.com/500x220.png?text=Sem+Imagem';
      
      slide.innerHTML = `
        <img src="${imgUrl}" alt="Imagem do cartão">
        <h2>${cartao.name}</h2>
        <p>${cartao.desc || 'Sem descrição'}</p>
      `;
      carrossel.appendChild(slide);
      slides.push(slide);
    }

    function carregarCartoes(t) {
      t.cards('all')
        .then(cartoes => {
          status.style.display = 'none';
          const ativos = cartoes.filter(c => !c.closed);
          
          if (ativos.length === 0) {
            status.textContent = 'Nenhum cartão encontrado.';
            status.style.display = 'block';
            return;
          }

          ativos.forEach(criarSlide);
          if (slides.length > 0) {
            mostrarSlide(0);
          } else {
            status.textContent = 'Nenhum cartão com anexo encontrado.';
            status.style.display = 'block';
          }
        })
        .catch(err => {
          status.textContent = 'Erro ao carregar cartões.';
          console.error('Erro:', err);
        });
    }

    document.getElementById('anterior').onclick = () => {
      if (slides.length > 0) mostrarSlide((atual - 1 + slides.length) % slides.length);
    };
    document.getElementById('proximo').onclick = () => {
      if (slides.length > 0) mostrarSlide((atual + 1) % slides.length);
    };

    // Inicializa o Power-Up e carrega os cartões
    window.TrelloPowerUp.ready(function() {
      const t = window.TrelloPowerUp.iframe();
      carregarCartoes(t);
    });
  </script>
</body>
</html> 
