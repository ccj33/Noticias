<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Destaques com OCR</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
    }
    #carousel {
      position: relative;
      max-width: 600px;
      margin: auto;
    }
    .slide {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .slide.active {
      display: block;
    }
    .slide img {
      width: 100%;
      max-height: 240px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .slide h2 {
      font-size: 20px;
      color: #0079bf;
      margin: 10px 0 5px;
    }
    .slide p {
      color: #333;
      font-size: 15px;
    }
    .slide a {
      color: #0079bf;
      font-weight: bold;
      display: inline-block;
      margin-top: 8px;
      text-decoration: none;
    }
    .controls {
      text-align: center;
      margin-top: 16px;
    }
    .controls button {
      background: #0079bf;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 0 10px;
    }
    #toggle {
      display: block;
      margin: 0 auto 20px auto;
      background: #ff9800;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="toggle">Desativar Destaques</button>
  <div id="carousel"><p>Carregando destaques...</p></div>
  <div class="controls">
    <button id="prevBtn">‚è™ Anterior</button>
    <button id="nextBtn">Pr√≥ximo ‚è©</button>
  </div>

  <script>
    const t = window.TrelloPowerUp ? TrelloPowerUp.iframe() : null;
    const carousel = document.getElementById("carousel");
    let slides = [], current = 0, interval = null, ativo = true;

    function showSlide(index) {
      slides.forEach((s, i) => {
        s.classList.toggle("active", i === index);
      });
    }
    function nextSlide() {
      if (slides.length > 0) {
        current = (current + 1) % slides.length;
        showSlide(current);
      }
    }
    function prevSlide() {
      if (slides.length > 0) {
        current = (current - 1 + slides.length) % slides.length;
        showSlide(current);
      }
    }
    function startAutoAdvance() {
      interval = setInterval(nextSlide, 6000);
    }
    function resetAutoAdvance() {
      clearInterval(interval);
      startAutoAdvance();
    }
    function createSlide(card, imageUrl) {
      const slide = document.createElement("div");
      slide.className = "slide";
      const link = card.desc && card.desc.match(/https?:\/\/[^\s]+/)?.[0] || "#";
      const loadingMsg = document.createElement("p");
      loadingMsg.textContent = "üîé Lendo texto da imagem...";
      slide.appendChild(loadingMsg);
      const img = document.createElement("img");
      img.src = imageUrl;
      img.onload = () => {
        Tesseract.recognize(
          imageUrl,
          'por',
          { logger: m => console.log(m) }
        ).then(({ data: { text } }) => {
          slide.innerHTML = `
            <img src="${imageUrl}" alt="Imagem OCR">
            <h2>${card.name}</h2>
            <p>${text.trim() || "‚ö†Ô∏è Nenhum texto reconhecido."}</p>
            <a href="${link}" target="_blank">üîó Ler mais</a>
          `;
        }).catch(err => {
          slide.innerHTML = `
            <img src="${imageUrl}" alt="Erro OCR">
            <h2>${card.name}</h2>
            <p>‚ùå Erro ao processar imagem.</p>
            <a href="${link}" target="_blank">üîó Ler mais</a>
          `;
        });
      };
      carousel.appendChild(slide);
      slides.push(slide);
    }
    function simularCartoes() {
      return [
        {
          name: "Not√≠cia 1",
          desc: "https://g1.globo.com/",
          attachments: [
            { url: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80" }
          ],
          closed: false
        },
        {
          name: "Not√≠cia 2",
          desc: "https://www.bbc.com/",
          attachments: [
            { url: "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80" }
          ],
          closed: false
        },
        {
          name: "Not√≠cia 3",
          desc: "https://www.cnnbrasil.com.br/",
          attachments: [],
          closed: false
        }
      ];
    }
    function carregarCartoes() {
      slides = [];
      carousel.innerHTML = '';
      if (t) {
        t.cards('all').then(cards => {
          const ativos = cards.filter(c => !c.closed);
          ativos.forEach(card => {
            const img = (card.attachments && card.attachments.length > 0)
              ? card.attachments[0].url
              : "https://source.unsplash.com/600x300/?news";
            createSlide(card, img);
          });
          if (slides.length > 0) {
            showSlide(0);
            startAutoAdvance();
          } else {
            carousel.innerHTML = "<p>Nenhum cart√£o encontrado.</p>";
          }
        });
      } else {
        // Simula√ß√£o local
        setTimeout(() => {
          const cards = simularCartoes();
          cards.forEach(card => {
            const img = (card.attachments && card.attachments.length > 0)
              ? card.attachments[0].url
              : "https://source.unsplash.com/600x300/?news";
            createSlide(card, img);
          });
          if (slides.length > 0) {
            showSlide(0);
            startAutoAdvance();
          } else {
            carousel.innerHTML = "<p>Nenhum cart√£o simulado encontrado.</p>";
          }
        }, 500);
      }
    }
    document.getElementById("prevBtn").addEventListener("click", () => {
      prevSlide();
      resetAutoAdvance();
    });
    document.getElementById("nextBtn").addEventListener("click", () => {
      nextSlide();
      resetAutoAdvance();
    });
    document.getElementById("toggle").addEventListener("click", () => {
      ativo = !ativo;
      if (ativo) {
        document.getElementById("toggle").textContent = "Desativar Destaques";
        document.getElementById("carousel").style.display = '';
        document.querySelector('.controls').style.display = '';
      } else {
        document.getElementById("toggle").textContent = "Ativar Destaques";
        document.getElementById("carousel").style.display = 'none';
        document.querySelector('.controls').style.display = 'none';
      }
    });
    carregarCartoes();
  </script>
</body>
</html> 
