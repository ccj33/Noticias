<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Calend√°rio do Quadro</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
    }
    .calendar-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .calendar-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .calendar-day {
      padding: 8px;
      text-align: center;
      border: 1px solid #eee;
      cursor: pointer;
      min-height: 40px;
      position: relative;
    }
    .calendar-day:hover {
      background: #f0f0f0;
    }
    .calendar-day.today {
      background: #0079bf;
      color: white;
    }
    .calendar-day.has-cards {
      background: #ff6b6b;
      color: white;
    }
    .weekday-header {
      font-weight: bold;
      background: #f5f5f5;
      padding: 8px;
      text-align: center;
    }
    .card-indicator {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 6px;
      height: 6px;
      background: #ff6b6b;
      border-radius: 50%;
    }
    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .nav-button {
      background: #0079bf;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    .nav-button:hover {
      background: #005f8c;
    }
  </style>
</head>
<body>
  <div class="calendar-container">
    <div class="calendar-header">
      <h2>üìÖ Calend√°rio do Quadro</h2>
    </div>
    
    <div class="month-navigation">
      <button class="nav-button" id="prevMonth">‚Üê M√™s Anterior</button>
      <h3 id="currentMonth">Dezembro 2024</h3>
      <button class="nav-button" id="nextMonth">Pr√≥ximo M√™s ‚Üí</button>
    </div>
    
    <div id="calendar"></div>
  </div>

  <script>
    const t = window.TrelloPowerUp ? TrelloPowerUp.iframe() : null;
    let currentDate = new Date();
    let cardsByDate = {};

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function generateCalendar() {
      const calendar = document.getElementById('calendar');
      const currentMonth = currentDate.getMonth();
      const currentYear = currentDate.getFullYear();
      
      // Atualizar t√≠tulo do m√™s
      const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                         'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
      document.getElementById('currentMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
      
      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
      const today = new Date();
      
      let html = '<div class="calendar-grid">';
      
      // Cabe√ßalho dos dias da semana
      weekdays.forEach(day => {
        html += `<div class="weekday-header">${day}</div>`;
      });
      
      // Dias do calend√°rio
      for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const isCurrentMonth = date.getMonth() === currentMonth;
        const isToday = date.toDateString() === today.toDateString();
        const dateKey = formatDate(date);
        const hasCards = cardsByDate[dateKey] && cardsByDate[dateKey].length > 0;
        
        let dayClass = 'calendar-day';
        if (isToday) dayClass += ' today';
        if (hasCards) dayClass += ' has-cards';
        
        const opacity = isCurrentMonth ? '1' : '0.5';
        const cardCount = hasCards ? cardsByDate[dateKey].length : 0;
        
        html += `
          <div class="${dayClass}" style="opacity: ${opacity}" data-date="${dateKey}">
            ${date.getDate()}
            ${hasCards ? `<div class="card-indicator" title="${cardCount} cart√µes"></div>` : ''}
          </div>
        `;
      }
      
      html += '</div>';
      calendar.innerHTML = html;
    }

    function loadCards() {
      if (t) {
        t.cards('all').then(cards => {
          cardsByDate = {};
          
          cards.forEach(card => {
            if (card.due) {
              const dueDate = new Date(card.due);
              const dateKey = formatDate(dueDate);
              
              if (!cardsByDate[dateKey]) {
                cardsByDate[dateKey] = [];
              }
              cardsByDate[dateKey].push(card);
            }
          });
          
          generateCalendar();
        });
      } else {
        // Simula√ß√£o para teste local
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        cardsByDate = {
          [formatDate(today)]: [
            { name: 'Tarefa de hoje', due: today.toISOString() }
          ],
          [formatDate(tomorrow)]: [
            { name: 'Tarefa de amanh√£', due: tomorrow.toISOString() }
          ]
        };
        
        generateCalendar();
      }
    }

    // Event listeners
    document.getElementById('prevMonth').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      generateCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      generateCalendar();
    });

    // Inicializar
    loadCards();
  </script>
</body>
</html> 
